# Configuração do Sistema de Odometria Robusta Caramelo
# Fusão sensorial: ROS Topics (joint_states + IMU) + Backup Cinemático

robust_odometry_node:
  ros__parameters:
    # =====================================================
    # PARÂMETROS FÍSICOS DO ROBÔ CARAMELO
    # =====================================================
    wheel_radius: 0.05        # Raio das rodas em metros (diâmetro 10cm)
    wheel_base: 0.47          # Distância entre eixos dianteiro/traseiro 
    wheel_separation: 0.31    # Distância entre centros das rodas esquerda/direita
    
    # =====================================================
    # CONFIGURAÇÃO DOS ENCODERS (via ROS Topics)
    # =====================================================
    encoder_pulses_per_revolution: 57344  # Pulsos por volta da roda (já com gear box)
    gear_ratio: 28.0          # Relação de transmissão motor:roda
    
    # =====================================================
    # TÓPICOS ROS (NÃO conecta diretamente ao hardware)
    # =====================================================
    use_hardware_direct: false     # LER DADOS DO ROS, não do hardware
    joint_states_topic: "/joint_states"    # ESP32 encoders via ROS
    imu_topic: "/zed/zed_node/imu/data"    # ZED2i IMU via ROS
    cmd_vel_topic: "/cmd_vel"              # Comandos de velocidade
    
    # =====================================================
    # FREQUÊNCIAS DO SISTEMA
    # =====================================================
    odometry_frequency: 50.0       # Hz - Frequência principal de odometria
    joint_states_timeout: 2.0      # Timeout para /joint_states
    imu_timeout: 2.0               # Timeout para dados do IMU ZED2i
    
    # =====================================================
    # CONFIGURAÇÃO DO EXTENDED KALMAN FILTER
    # =====================================================
    use_imu_orientation: true      # Usar giroscópio para orientação
    use_imu_acceleration: true     # Usar acelerômetro para validação movimento
    
    # Variâncias de ruído dos sensores
    encoder_noise_variance: 0.01   # Confiança nos encoders (via joint_states)
    imu_angular_velocity_variance: 0.02   # Confiança no giroscópio ZED2i
    imu_acceleration_variance: 0.1  # Confiança no acelerômetro ZED2i
    
    # =====================================================
    # BACKUP E RECUPERAÇÃO
    # =====================================================
    enable_kinematic_backup: true  # Usar modelo cinemático quando sensores falham
    backup_cmd_vel_timeout: 1.0    # Tempo para usar última velocidade conhecida
    auto_recovery_enabled: true    # Reconexão automática de tópicos
    recovery_check_interval: 5.0  # Intervalo de verificação de tópicos
